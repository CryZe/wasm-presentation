<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/wasm.css">
		<link rel="stylesheet" href="css/wasm.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai-sublime.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );

			var xhr = new XMLHttpRequest();
            xhr.open('GET', 'sysprog.wasm', true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function() {
                var config = { wasmBinary: xhr.response, printErr: printErr };
                var codeXHR = new XMLHttpRequest();
                codeXHR.open('GET', 'sysprog.js', true);
                codeXHR.onload = function() {
                    var code = codeXHR.responseText;
                    var blob = new Blob([code], {type: 'text/javascript'});
                    codeXHR = null;
                    var src = URL.createObjectURL(blob);
                    var script = document.createElement('script');
                    script.src = URL.createObjectURL(blob);
                    script.onload = function() {
                        URL.revokeObjectURL(script.src);
                        var sysprog = SysProg(config);
                        parse = sysprog.cwrap('parse', 'string', ['string']);
                        format = sysprog.cwrap('format_asm', 'string', ['string']);
                        interpret = sysprog.cwrap('interpret', 'string', ['string', 'number']);
                    };
                    document.body.appendChild(script);
                }
                codeXHR.send(null);
            };
            xhr.send(null);

			isCompiling = false;
            function printErr(e) {
                if (isCompiling) {
                    document.getElementById("result").innerText += e + "\n";
                } else {
                    console.warn(e);
                }
            }

			function compile() {
                console.log("Compiling...");
                var code = document.getElementById("code").innerText;
                try {
					Reveal.next();
                    isCompiling = true;
                    var asm = parse(code);
                    asm = format(asm);
                    document.getElementById("result").innerText = "Compilation successful!";
                    document.getElementById("asm").innerText = asm;
                } catch (e) {
                    printErr(e);
                    document.getElementById("asm").innerText = "";
                }
                isCompiling = false;
            }

			function runASM() {
                console.log("Running...");
                var asm = document.getElementById("asm").innerText;
                var result = interpret(asm, 0);
                document.getElementById("result").innerText = result;
            }
		</script>
		<script async type="text/javascript" src="physics-test.js"></script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1 style="font-size: 3.0em;">WebAssembly</h1>

					<img src="wasm_green.svg"
					     style="background: none; border: none; box-shadow: none;" />
				</section>

				<section>
					<h2>
						<img src="js.jpg" />
						<span style="vertical-align: super;">JavaScript</span>
					</h2>

					<ul>
						<li>Im Mai 1995 in nur 10 Tagen entwickelt</li>
						<li>Einzig weiträumig verfügbare Skriptsprache des Webs</li>
						<li>Ursprünglich für kleine Skripts gedacht</li>
						<li>Wird heutzutage für riesige Web Apps verwendet</li>
					</ul>
				</section>

				<section>
					<h2>
						<img src="flash.png" />
						<span style="vertical-align: super;">Adobe Flash</span>
					</h2>

					<ul>
						<li>Browser Add-on zur Darstellung von interaktiven Inhalten</li>
						<li>Kann direkt in HTML integriert werden</li>
						<li>Vorallem zur Darstellung von Videos und Werbebannern etabliert</li>
						<li>Großes Sicherheitsrisiko, da Sandbox des Browsers umgangen wird</li>
						<li>Von vielen mobilen Plattformen nicht mehr unterstützt</li>
					</ul>
				</section>

				<section>
					<h2>asm.js</h2>

					<section>
						<ul>
							<li>JavaScript als Kompilierziel</li>
							<li>Ausgerichtet auf Sprachen mit manuellem Speichermanagement</li>
							<li>Strenge Teilmenge von JavaScript</li>
						</ul>
					</section>

					<section>
						<pre><code class="hljs javascript" data-trim style="line-height: 1.2em; font-size: 1.7em;">
function add(a, b) {
	a = a | 0;
	b = b | 0;
	return (a + b) | 0;
}
						</code></pre>
						<div class="fragment">
							<ul>
								<li>Bitweises Oder mit 0 als 32-Bit Integer Annotation</li>
								<li>Von älteren Browsern ignoriert</li>
								<li>Von modernen Browsern als Optimierung erkannt</li>
							</ul>
						</div>
					</section>

					<section>
						<pre><code class="hljs javascript" data-trim style="line-height: 1.2em;font-size: 1.3em;">
function strlen(pointer) {
	pointer = pointer | 0;
	var current = 0;
	current = pointer;
	while (HEAP8[current] | 0 != 0) {
		current = (current + 1) | 0;
	}
	return (current - pointer) | 0;
}
						</code></pre>
						<div class="fragment">
							<ul>
								<li>Heap wird als Array von Bytes kodiert</li>
								<li>Zeiger stellen Indizes des Arrays dar</li>
								<li>Umgeht Garbage Collection der Virtual Machine</li>
							</ul>
						</div>
					</section>
				</section>

				<section>
					<h2>
						<img src="wasm_green.svg" />
						<span style="vertical-align: super;">WebAssembly</span>
					</h2>

					<section>
						<ul>
							<li>Seit 2015 in Entwicklung</li>
							<li>Unterstützt Apple, Microsoft, Google und Mozilla</li>
							<li>Byteformat auf Basis von asm.js</li>
							<li>Aufbauend auf JavaScript VM</li>
						</ul>
					</section>

					<section>
						<h4>Unterschiede zu JavaScript</h4>
						<ul>
							<li>Schnelleres Parsen</li>
							<li>Multi Threading</li>
							<li>Typisierter Code</li>
							<li>Native Ganzzahltypen</li>
							<li>Manuelle Speicherverwaltung</li>
						</ul>
					</section>

					<section>
						<table>
							<thead>
								<tr>
									<th>C++</th>
									<th>Bytes</th>
									<th>Text</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td style="padding: 0.2em 0.3em 0.2em 0.3em;">
										<pre style="width: 100%" ><code class="hljs cpp" data-trim style="line-height: 1.2em;font-size: 1em;">
int factorial(int n) {
  if (n == 0)
    return 1;
  else
    return n * fac(n-1);
}
										</code></pre>
									</td>
									<td style="padding: 0.2em 0.3em 0.2em 0.3em;">
										<pre style="width: 100%" ><code class="hljs text" data-trim style="line-height: 1.2em;font-size: 1em;">
20 00
42 00
51
04 7e
42 01
05
20 00
20 00
42 01
7d
10 00
7e
0b
										</code></pre>
									</td>
									<td style="padding: 0.2em 0.3em 0.2em 0.3em;">
										<pre style="width: 100%" ><code class="hljs text" data-trim style="line-height: 1.2em;font-size: 1em;">
get_local 0
i64.const 0
i64.eq
if i64
    i64.const 1
else
    get_local 0
    get_local 0
    i64.const 1
    i64.sub
    call 0
    i64.mul
end
										</code></pre>
									</td>
								</tr>
							</tbody>
						</table>
					</section>
				</section>

				<section>
					<h2>Demos</h2>

					<section>
						<pre style="width: 100%" ><code id="code" class="hljs cpp" contenteditable data-trim style="line-height: 1.2em;font-size: 1em;">
/* Heron-Verfahren zur Berechnung der Quadratwurzel */

int input;
int xn;
int xn1;

read(input);
xn = 0;
xn1 = (input + 1) / 2;

while (xn =!= xn1)
{
	xn = xn1;
	xn1 = (xn + (input / xn)) / 2;
};

print(xn);
						</code></pre>
						<button class="btn" onclick="compile();">Compile</button>
					</section>
					<section>
						<pre style="width: 100%" ><code id="asm" class="hljs no-highlight" contenteditable data-trim style="line-height: 1.2em;font-size: 1em; height: 17em;">
						</code></pre>
						<pre style="width: 100%" ><code id="result" class="hljs no-highlight" data-trim style="line-height: 1.2em;font-size: 2em;">
Compile your code to see a result!
						</code></pre>
						<button class="btn" onclick="runASM();">Run</button>
					</section>
					<section>
						<div class="domain"></div>
						<button class="btn" id="spawn">Spawn</button>
					</section>
				</section>
				<section>
					<h2>Benchmark</h2>
					<canvas class="stretch" data-chart="horizontalBar">
<!--
{
 "data": {
  "labels": ["Nativ (57 ms)", "wasm Firefox (143 ms)", "asm.js Firefox (162 ms)", "asm.js Edge (199 ms)", "wasm Chrome (223 ms)", "asm.js Chrome (268 ms)", "ES6 Chrome (2898 ms)", "ES6 Edge (3240 ms)", "ES6 Firefox (5558 ms)"],
  "datasets": [
   {
    "data":[57.26, 143.35, 162.43, 199.70, 223.80, 268.60, 2898.20, 3240.00, 5558.88],
    "label":"Ausführungszeit (ms)"
   }
  ]
 },
 "options": { "responsive": "true" }
}
-->
</canvas>
				</section>
				<section>
					<h2>Fazit</h2>
					<ul>
						<li>Große Performancevorteile gegenüber JavaScript<ul><li>meist mindestens 10x</li><li>oftmals bis 40x</li></ul></li>
						<li>asm.js bereits sehr stabil</li>
						<li>Kompilierung nach WebAssembly noch fehleranfällig</li>
						<li>Optimale Ergänzung zu JavaScript für kritische Codestellen</li>
						<li>Hocheffiziente, plattformunabhängige Codebasen möglich</li>
					</ul>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				controls: false,
				center: false,
				slideNumber: true,

				chart: {
					defaults: {
						global: {
							defaultFontFamily: 'Ubuntu, "sans-serif"',
							defaultFontSize: 24,
							title: { fontColor: "#FFF" },
						},
						legend: {
							labels: { fontColor: "#FFF" },
						},
						scale: {
							scaleLabel: { fontColor: "#FFF" },
							gridLines: { color: "#888", zeroLineColor: "#888" },
							ticks: { fontColor: "#FFF" },
						}
					},
					line: { borderColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ], "borderDash": [ [5,10], [0,0] ]},
					horizontalBar: {
						backgroundColor: [ "#30bf30" , "#30bf30", "#30bf30" ]
					},
					pie: { backgroundColor: [ ["rgba(0,0,0,.8)" , "rgba(220,20,20,.8)", "rgba(20,220,20,.8)", "rgba(220,220,20,.8)", "rgba(20,20,220,.8)"] ]},
					radar: { borderColor: [ "rgba(20,220,220,.8)" , "rgba(220,120,120,.8)", "rgba(20,120,220,.8)" ]},
				},

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() {
						hljs.initHighlightingOnLoad();
						hljs.configure({tabReplace: '    '});
					} },
					{ src: 'plugin/chart/Chart.min.js' },
					{ src: 'plugin/chart/csv2chart.js' }
				]
			});
		</script>
	</body>
</html>
